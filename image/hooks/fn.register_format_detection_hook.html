<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Registers a format detection hook."><title>register_format_detection_hook in image::hooks - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-aa0817cf.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="image" data-themes="" data-resource-suffix="" data-rustdoc-version="1.90.0 (1159e78c4 2025-09-14)" data-channel="1.90.0" data-search-js="search-fa3e91e5.js" data-settings-js="settings-5514c975.js" ><script src="../../static.files/storage-68b7e25d.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-eebb9057.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-32bb7600.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../image/index.html">image</a><span class="version">0.25.8</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">register_<wbr>format_<wbr>detection_<wbr>hook</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#examples" title="Examples">Examples</a><ul><li><a href="#using-the-mask-to-ignore-some-bytes" title="Using the mask to ignore some bytes">Using the mask to ignore some bytes</a></li><li><a href="#multiple-signatures" title="Multiple signatures">Multiple signatures</a></li></ul></li></ul></section><div id="rustdoc-modnav"><h2><a href="index.html">In image::<wbr>hooks</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../index.html">image</a>::<wbr><a href="index.html">hooks</a></div><h1>Function <span class="fn">register_format_detection_hook</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/image/hooks.rs.html#130-139">Source</a> </span></div><pre class="rust item-decl"><code>pub fn register_format_detection_hook(
    extension: <a class="struct" href="https://doc.rust-lang.org/1.90.0/std/ffi/os_str/struct.OsString.html" title="struct std::ffi::os_str::OsString">OsString</a>,
    signature: &amp;'static [<a class="primitive" href="https://doc.rust-lang.org/1.90.0/std/primitive.u8.html">u8</a>],
    mask: <a class="enum" href="https://doc.rust-lang.org/1.90.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;&amp;'static [<a class="primitive" href="https://doc.rust-lang.org/1.90.0/std/primitive.u8.html">u8</a>]&gt;,
)</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Registers a format detection hook.</p>
<p>The signature field holds the magic bytes from the start of the file that must be matched to
detect the format. The mask field is optional and can be used to specify which bytes in the
signature should be ignored during the detection.</p>
<h2 id="examples"><a class="doc-anchor" href="#examples">ยง</a>Examples</h2><h3 id="using-the-mask-to-ignore-some-bytes"><a class="doc-anchor" href="#using-the-mask-to-ignore-some-bytes">ยง</a>Using the mask to ignore some bytes</h3>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// WebP signature is 'riff' followed by 4 bytes of length and then by 'webp'.
// This requires a mask to ignore the length.
</span>register_format_detection_hook(<span class="string">"webp"</span>.into(),
     <span class="kw-2">&amp;</span>[<span class="string">b'r'</span>, <span class="string">b'i'</span>, <span class="string">b'f'</span>, <span class="string">b'f'</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="string">b'w'</span>, <span class="string">b'e'</span>, <span class="string">b'b'</span>, <span class="string">b'p'</span>],
<span class="prelude-val">Some</span>(<span class="kw-2">&amp;</span>[<span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xff</span>]),
);</code></pre></div>
<h3 id="multiple-signatures"><a class="doc-anchor" href="#multiple-signatures">ยง</a>Multiple signatures</h3>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// JPEG XL has two different signatures: https://en.wikipedia.org/wiki/JPEG_XL
// This function should be called twice to register them both.
</span>register_format_detection_hook(<span class="string">"jxl"</span>.into(), <span class="kw-2">&amp;</span>[<span class="number">0xff</span>, <span class="number">0x0a</span>], <span class="prelude-val">None</span>);
register_format_detection_hook(<span class="string">"jxl"</span>.into(),
     <span class="kw-2">&amp;</span>[<span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0c</span>, <span class="number">0x4a</span>, <span class="number">0x58</span>, <span class="number">0x4c</span>, <span class="number">0x20</span>, <span class="number">0x0d</span>, <span class="number">0x0a</span>, <span class="number">0x87</span>, <span class="number">0x0a</span>], <span class="prelude-val">None</span>,
);</code></pre></div>
</div></details></section></div></main></body></html>