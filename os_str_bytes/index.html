<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This crate allows interacting with the data stored by `OsStr` and `OsString`, without resorting to panics or corruption for invalid UTF-8. Thus, methods can be used that are already defined on `[u8]` and `Vec&#60;u8&#62;`."><title>os_str_bytes - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../static.files/rustdoc-aa0817cf.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="os_str_bytes" data-themes="" data-resource-suffix="" data-rustdoc-version="1.90.0 (1159e78c4 2025-09-14)" data-channel="1.90.0" data-search-js="search-fa3e91e5.js" data-settings-js="settings-5514c975.js" ><script src="../static.files/storage-68b7e25d.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-eebb9057.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-32bb7600.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-044be391.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../os_str_bytes/index.html">os_<wbr>str_<wbr>bytes</a><span class="version">6.6.1</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section id="rustdoc-toc"><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#encoding" title="Encoding">Encoding</a></li><li><a href="#user-input" title="User Input">User Input</a></li><li><a href="#features" title="Features">Features</a><ul><li><a href="#default-features" title="Default Features">Default Features</a></li><li><a href="#optional-features" title="Optional Features">Optional Features</a></li><li><a href="#nightly-features" title="Nightly Features">Nightly Features</a></li></ul></li><li><a href="#implementation" title="Implementation">Implementation</a></li><li><a href="#complexity" title="Complexity">Complexity</a></li><li><a href="#examples" title="Examples">Examples</a></li></ul><h3><a href="#modules">Crate Items</a></h3><ul class="block"><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#traits" title="Traits">Traits</a></li></ul></section><div id="rustdoc-modnav"></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <span>os_str_bytes</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/os_str_bytes/lib.rs.html#1-1189">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This crate allows interacting with the data stored by <a href="https://doc.rust-lang.org/1.90.0/std/ffi/os_str/struct.OsStr.html" title="struct std::ffi::os_str::OsStr"><code>OsStr</code></a> and
<a href="https://doc.rust-lang.org/1.90.0/std/ffi/os_str/struct.OsString.html" title="struct std::ffi::os_str::OsString"><code>OsString</code></a>, without resorting to panics or corruption for invalid UTF-8.
Thus, methods can be used that are already defined on <a href="https://doc.rust-lang.org/1.90.0/std/primitive.slice.html" title="primitive slice"><code>[u8]</code></a> and
<a href="https://doc.rust-lang.org/1.90.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec"><code>Vec&lt;u8&gt;</code></a>.</p>
<p>Typically, the only way to losslessly construct <a href="https://doc.rust-lang.org/1.90.0/std/ffi/os_str/struct.OsStr.html" title="struct std::ffi::os_str::OsStr"><code>OsStr</code></a> or <a href="https://doc.rust-lang.org/1.90.0/std/ffi/os_str/struct.OsString.html" title="struct std::ffi::os_str::OsString"><code>OsString</code></a>
from a byte sequence is to use <code>OsStr::new(str::from_utf8(bytes)?)</code>, which
requires the bytes to be valid in UTF-8. However, since this crate makes
conversions directly between the platform encoding and raw bytes, even some
strings invalid in UTF-8 can be converted.</p>
<p>In most cases, <a href="struct.RawOsStr.html" title="struct os_str_bytes::RawOsStr"><code>RawOsStr</code></a> and <a href="struct.RawOsString.html" title="struct os_str_bytes::RawOsString"><code>RawOsString</code></a> should be used.
<a href="trait.OsStrBytes.html" title="trait os_str_bytes::OsStrBytes"><code>OsStrBytes</code></a> and <a href="trait.OsStringBytes.html" title="trait os_str_bytes::OsStringBytes"><code>OsStringBytes</code></a> provide lower-level APIs that are
easier to misuse.</p>
<h2 id="encoding"><a class="doc-anchor" href="#encoding">§</a>Encoding</h2>
<p>The encoding of bytes returned or accepted by methods of this crate is
intentionally left unspecified. It may vary for different platforms, so
defining it would run contrary to the goal of generic string handling.
However, the following invariants will always be upheld:</p>
<ul>
<li>
<p>The encoding will be compatible with UTF-8. In particular, splitting an
encoded byte sequence by a UTF-8–encoded character always produces
other valid byte sequences. They can be re-encoded without error using
<a href="struct.RawOsString.html#method.into_os_string" title="method os_str_bytes::RawOsString::into_os_string"><code>RawOsString::into_os_string</code></a> and similar methods.</p>
</li>
<li>
<p>All characters valid in platform strings are representable. <a href="https://doc.rust-lang.org/1.90.0/std/ffi/os_str/struct.OsStr.html" title="struct std::ffi::os_str::OsStr"><code>OsStr</code></a> and
<a href="https://doc.rust-lang.org/1.90.0/std/ffi/os_str/struct.OsString.html" title="struct std::ffi::os_str::OsString"><code>OsString</code></a> can always be losslessly reconstructed from extracted bytes.</p>
</li>
</ul>
<p>Note that the chosen encoding may not match how Rust stores these strings
internally, which is undocumented. For instance, the result of calling
<a href="https://doc.rust-lang.org/1.90.0/std/ffi/os_str/struct.OsStr.html#method.len" title="method std::ffi::os_str::OsStr::len"><code>OsStr::len</code></a> will not necessarily match the number of bytes this crate
uses to represent the same string.</p>
<p>Additionally, concatenation may yield unexpected results without a UTF-8
separator. If two platform strings need to be concatenated, the only safe
way to do so is using <a href="https://doc.rust-lang.org/1.90.0/std/ffi/os_str/struct.OsString.html#method.push" title="method std::ffi::os_str::OsString::push"><code>OsString::push</code></a>. This limitation also makes it
undesirable to use the bytes in interchange.</p>
<p>Since this encoding can change between versions and platforms, it should
not be used for storage. The standard library provides implementations of
<a href="https://doc.rust-lang.org/1.90.0/std/os/unix/ffi/os_str/trait.OsStrExt.html" title="trait std::os::unix::ffi::os_str::OsStrExt"><code>OsStrExt</code></a> and <a href="https://doc.rust-lang.org/1.90.0/std/os/unix/ffi/os_str/trait.OsStringExt.html" title="trait std::os::unix::ffi::os_str::OsStringExt"><code>OsStringExt</code></a> for various platforms, which should be
preferred for that use case.</p>
<h2 id="user-input"><a class="doc-anchor" href="#user-input">§</a>User Input</h2>
<p>Traits in this crate should ideally not be used to convert byte sequences
that did not originate from <a href="https://doc.rust-lang.org/1.90.0/std/ffi/os_str/struct.OsStr.html" title="struct std::ffi::os_str::OsStr"><code>OsStr</code></a> or a related struct. The encoding
used by this crate is an implementation detail, so it does not make sense
to expose it to users.</p>
<p>Crate <a href="https://crates.io/crates/bstr">bstr</a> offers some useful alternative methods, such as
<a href="https://docs.rs/bstr/0.2.12/bstr/trait.ByteSlice.html#method.to_os_str"><code>ByteSlice::to_os_str</code></a> and <a href="https://docs.rs/bstr/0.2.12/bstr/trait.ByteVec.html#method.into_os_string"><code>ByteVec::into_os_string</code></a>, that are meant
for user input. But, they reject some byte sequences used to represent
valid platform strings, which would be undesirable for reliable path
handling. They are best used only when accepting unknown input.</p>
<p>This crate is meant to help when you already have an instance of <a href="https://doc.rust-lang.org/1.90.0/std/ffi/os_str/struct.OsStr.html" title="struct std::ffi::os_str::OsStr"><code>OsStr</code></a>
and need to modify the data in a lossless way.</p>
<h2 id="features"><a class="doc-anchor" href="#features">§</a>Features</h2>
<p>These features are optional and can be enabled or disabled in a
“Cargo.toml” file.</p>
<h4 id="default-features"><a class="doc-anchor" href="#default-features">§</a>Default Features</h4>
<ul>
<li>
<p><strong>memchr</strong> -
Changes the implementation to use crate <a href="https://crates.io/crates/memchr">memchr</a> for better performance.
This feature is useless when “raw_os_str” is disabled.</p>
<p>For more information, see <a href="struct.RawOsStr.html#complexity" title="struct os_str_bytes::RawOsStr"><code>RawOsStr</code></a>.</p>
</li>
<li>
<p><strong>raw_os_str</strong> -
Provides:</p>
<ul>
<li><a href="iter/index.html" title="mod os_str_bytes::iter"><code>iter</code></a></li>
<li><a href="trait.Pattern.html" title="trait os_str_bytes::Pattern"><code>Pattern</code></a></li>
<li>[<code>OsStrBytesExt</code>]</li>
<li><a href="struct.RawOsStr.html" title="struct os_str_bytes::RawOsStr"><code>RawOsStr</code></a></li>
<li><a href="trait.RawOsStrCow.html" title="trait os_str_bytes::RawOsStrCow"><code>RawOsStrCow</code></a></li>
<li><a href="struct.RawOsString.html" title="struct os_str_bytes::RawOsString"><code>RawOsString</code></a></li>
</ul>
</li>
</ul>
<h4 id="optional-features"><a class="doc-anchor" href="#optional-features">§</a>Optional Features</h4>
<ul>
<li>
<p><strong>checked_conversions</strong> -
Provides:</p>
<ul>
<li><a href="struct.EncodingError.html" title="struct os_str_bytes::EncodingError"><code>EncodingError</code></a></li>
<li><a href="trait.OsStrBytes.html#tymethod.from_raw_bytes" title="associated function os_str_bytes::OsStrBytes::from_raw_bytes"><code>OsStrBytes::from_raw_bytes</code></a></li>
<li><a href="trait.OsStringBytes.html#tymethod.from_raw_vec" title="associated function os_str_bytes::OsStringBytes::from_raw_vec"><code>OsStringBytes::from_raw_vec</code></a></li>
<li>[<code>RawOsStr::cow_from_raw_bytes</code>]</li>
<li>[<code>RawOsString::from_raw_vec</code>]</li>
</ul>
<p>Because this feature should not be used in libraries, the
“OS_STR_BYTES_CHECKED_CONVERSIONS” environment variable must be defined
during compilation.</p>
</li>
<li>
<p><strong>conversions</strong> -
Provides methods that require encoding conversion and may be expensive:</p>
<ul>
<li>[<code>OsStrBytesExt::ends_with_os</code>]</li>
<li>[<code>OsStrBytesExt::starts_with_os</code>]</li>
<li><a href="struct.RawOsStr.html#method.assert_cow_from_raw_bytes" title="associated function os_str_bytes::RawOsStr::assert_cow_from_raw_bytes"><code>RawOsStr::assert_cow_from_raw_bytes</code></a></li>
<li><a href="struct.RawOsStr.html#method.ends_with_os" title="method os_str_bytes::RawOsStr::ends_with_os"><code>RawOsStr::ends_with_os</code></a></li>
<li><a href="struct.RawOsStr.html#method.starts_with_os" title="method os_str_bytes::RawOsStr::starts_with_os"><code>RawOsStr::starts_with_os</code></a></li>
<li><a href="struct.RawOsStr.html#method.to_raw_bytes" title="method os_str_bytes::RawOsStr::to_raw_bytes"><code>RawOsStr::to_raw_bytes</code></a></li>
<li><a href="struct.RawOsString.html#method.assert_from_raw_vec" title="associated function os_str_bytes::RawOsString::assert_from_raw_vec"><code>RawOsString::assert_from_raw_vec</code></a></li>
<li><a href="struct.RawOsString.html#method.into_raw_vec" title="method os_str_bytes::RawOsString::into_raw_vec"><code>RawOsString::into_raw_vec</code></a></li>
<li><a href="trait.OsStrBytes.html" title="trait os_str_bytes::OsStrBytes"><code>OsStrBytes</code></a></li>
<li><a href="trait.OsStringBytes.html" title="trait os_str_bytes::OsStringBytes"><code>OsStringBytes</code></a></li>
</ul>
</li>
<li>
<p><strong>print_bytes</strong> -
Provides implementations of [<code>print_bytes::ToBytes</code>] for <a href="struct.RawOsStr.html" title="struct os_str_bytes::RawOsStr"><code>RawOsStr</code></a> and
<a href="struct.RawOsString.html" title="struct os_str_bytes::RawOsString"><code>RawOsString</code></a>.</p>
</li>
<li>
<p><strong>uniquote</strong> -
Provides implementations of [<code>uniquote::Quote</code>] for <a href="struct.RawOsStr.html" title="struct os_str_bytes::RawOsStr"><code>RawOsStr</code></a> and
<a href="struct.RawOsString.html" title="struct os_str_bytes::RawOsString"><code>RawOsString</code></a>.</p>
</li>
</ul>
<h4 id="nightly-features"><a class="doc-anchor" href="#nightly-features">§</a>Nightly Features</h4>
<p>These features are unstable, since they rely on unstable Rust features.</p>
<ul>
<li>
<p><strong>nightly</strong> -
Changes the implementation to use the <a href="https://doc.rust-lang.org/unstable-book/library-features/os-str-bytes.html">“os_str_bytes” nightly
feature</a> and provides:</p>
<ul>
<li>[<code>RawOsStr::as_encoded_bytes</code>]</li>
<li>[<code>RawOsStr::as_os_str</code>]</li>
<li>[<code>RawOsStr::from_encoded_bytes_unchecked</code>]</li>
<li>[<code>RawOsStr::from_os_str</code>]</li>
<li>[<code>RawOsString::from_encoded_vec_unchecked</code>]</li>
<li>[<code>RawOsString::into_encoded_vec</code>]</li>
<li>additional trait implementations for <a href="struct.RawOsStr.html" title="struct os_str_bytes::RawOsStr"><code>RawOsStr</code></a> and <a href="struct.RawOsString.html" title="struct os_str_bytes::RawOsString"><code>RawOsString</code></a></li>
</ul>
<p>When applicable, a “Nightly Notes” section will be added to documentation
descriptions, indicating differences when this feature is enabled.
However, it will not cause any breaking changes.</p>
<p>This feature will cause memory leaks for some newly deprecated methods.
Therefore, it is not recommended to use this feature until the next major
version, when those methods will be removed. However, it can be used to
prepare for upgrading and determine impact of the new feature.</p>
<p>Because this feature should not be used in libraries, the
“OS_STR_BYTES_NIGHTLY” environment variable must be defined during
compilation.</p>
</li>
</ul>
<h2 id="implementation"><a class="doc-anchor" href="#implementation">§</a>Implementation</h2>
<p>Some methods return <a href="https://doc.rust-lang.org/1.90.0/alloc/borrow/enum.Cow.html" title="enum alloc::borrow::Cow"><code>Cow</code></a> to account for platform differences. However,
no guarantee is made that the same variant of that enum will always be
returned for the same platform. Whichever can be constructed most
efficiently will be returned.</p>
<p>All traits are <a href="https://rust-lang.github.io/api-guidelines/future-proofing.html#c-sealed">sealed</a>, meaning that they can only be implemented by this
crate. Otherwise, backward compatibility would be more difficult to
maintain for new features.</p>
<h2 id="complexity"><a class="doc-anchor" href="#complexity">§</a>Complexity</h2>
<p>Conversion method complexities will vary based on what functionality is
available for the platform. At worst, they will all be linear, but some can
take constant time. For example, <a href="struct.RawOsString.html#method.into_os_string" title="method os_str_bytes::RawOsString::into_os_string"><code>RawOsString::into_os_string</code></a> might be
able to reuse its allocation.</p>
<h2 id="examples"><a class="doc-anchor" href="#examples">§</a>Examples</h2>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>std::env;
<span class="kw">use </span>std::fs;

<span class="kw">use </span>os_str_bytes::RawOsStr;

<span class="kw">for </span>file <span class="kw">in </span>env::args_os().skip(<span class="number">1</span>) {
    <span class="kw">if </span>!RawOsStr::new(<span class="kw-2">&amp;</span>file).starts_with(<span class="string">'-'</span>) {
        <span class="kw">let </span>string = <span class="string">"Hello, world!"</span>;
        fs::write(<span class="kw-2">&amp;</span>file, string)<span class="question-mark">?</span>;
        <span class="macro">assert_eq!</span>(string, fs::read_to_string(file)<span class="question-mark">?</span>);
    }
}</code></pre></div>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><dl class="item-table"><dt><a class="mod" href="iter/index.html" title="mod os_str_bytes::iter">iter</a></dt><dd>Iterators provided by this crate.</dd></dl><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.EncodingError.html" title="struct os_str_bytes::EncodingError">Encoding<wbr>Error</a><wbr><span class="stab deprecated" title="">Deprecated</span></dt><dd>The error that occurs when a byte sequence is not representable in the
platform encoding.</dd><dt><a class="struct" href="struct.RawOsStr.html" title="struct os_str_bytes::RawOsStr">RawOs<wbr>Str</a></dt><dd>A container for borrowed byte strings converted by this crate.</dd><dt><a class="struct" href="struct.RawOsString.html" title="struct os_str_bytes::RawOsString">RawOs<wbr>String</a></dt><dd>A container for owned byte strings converted by this crate.</dd></dl><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><dl class="item-table"><dt><a class="trait" href="trait.OsStrBytes.html" title="trait os_str_bytes::OsStrBytes">OsStr<wbr>Bytes</a><wbr><span class="stab deprecated" title="">Deprecated</span></dt><dd>A platform agnostic variant of <a href="https://doc.rust-lang.org/1.90.0/std/os/unix/ffi/os_str/trait.OsStrExt.html" title="trait std::os::unix::ffi::os_str::OsStrExt"><code>OsStrExt</code></a>.</dd><dt><a class="trait" href="trait.OsStringBytes.html" title="trait os_str_bytes::OsStringBytes">OsString<wbr>Bytes</a><wbr><span class="stab deprecated" title="">Deprecated</span></dt><dd>A platform agnostic variant of <a href="https://doc.rust-lang.org/1.90.0/std/os/unix/ffi/os_str/trait.OsStringExt.html" title="trait std::os::unix::ffi::os_str::OsStringExt"><code>OsStringExt</code></a>.</dd><dt><a class="trait" href="trait.Pattern.html" title="trait os_str_bytes::Pattern">Pattern</a></dt><dd>Allows a type to be used for searching by <a href="struct.RawOsStr.html" title="struct os_str_bytes::RawOsStr"><code>RawOsStr</code></a> and <a href="struct.RawOsString.html" title="struct os_str_bytes::RawOsString"><code>RawOsString</code></a>.</dd><dt><a class="trait" href="trait.RawOsStrCow.html" title="trait os_str_bytes::RawOsStrCow">RawOs<wbr>StrCow</a></dt><dd>Extensions to <a href="https://doc.rust-lang.org/1.90.0/alloc/borrow/enum.Cow.html" title="enum alloc::borrow::Cow"><code>Cow&lt;RawOsStr&gt;</code></a> for additional conversions.</dd></dl></section></div></main></body></html>